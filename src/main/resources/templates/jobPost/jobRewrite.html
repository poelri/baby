<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
    <!--헤더이 있는 토큰 값이 이거임 ! ! -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

</head>


<main layout:fragment="content" class="main" style="text-align: -webkit-center;">
    <div class="sub_head">
        <span class="sub_head_title1">등록수정</span>
        <!--        <span class="sub_head_title2">USE GUIDE</span>-->
    </div>
    <form role="form" th:action="@{'/jobPost/' + ${jobPostFormDto.id}}" method="post" enctype="multipart/form-data"
          th:object="${jobPostFormDto}" name="postForm">
        <input type="hidden" th:field="*{id}"/>

        <div class="box2">
            <div class="incruit_box1">
                <span class="incruit_title" th:for="jobTitle">제목</span>
            </div>
            <div class="incruite_box2">
                <input type="text" placeholder="제목을 입력해주세요" class="inputTitle"
                       th:field="*{jobTitle}">
            </div>

            <div>
                <ul>
                    <!--구직자 성별-->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">성별</span>
                        </div>
                        <div class="incruite_box2">
                            <ul class="horizontal-list">
                                <li>
                                    <label><input type="radio" class="jobGender" name="jobGender" value="FEMALE" checked="checked">여성</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobGender" name="jobGender" value="MALE">남성</label>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- 나이 -->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">연령</span>
                        </div>
                        <div class="incruite_box2">
                            <ul class="horizontal-list">
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="TEENS">10대</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="TWENTIES" checked="checked">20대</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="THIRTIES">30대</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="FORTIES">40대</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="FIFTIES">50대</label>
                                </li>
                                <li>
                                    <label><input type="radio" class="jobAge" name="jobAge" value="SIXTIES">60대</label>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <!-- 경력-->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">헬퍼의 경력</span>
                        </div>
                        <div class="incruite_box2">
                            <ul class="horizontal-list">
                                <li>
                                    <label><input type="radio" checked="checked"  name="career" value="ZERO">신입</label>
                                </li>
                                <li>
                                    <label><input type="radio" name="career" value="ONE">1년이상</label>
                                </li>
                                <li>
                                    <label><input type="radio"  name="career" value="TWO">2년이상</label>
                                </li>
                                <li>
                                    <label><input type="radio"  name="career" value="THREE">3년이상</label>
                                </li>
                                <li>
                                    <label><input type="radio"  name="career" value="FOUR">4년이상</label>
                                </li>
                                <li>
                                    <label><input type="radio" name="career" value="FIVE">5년이상</label>
                                </li>

                            </ul>
                        </div>
                    </li>
                </ul>
                <ul>
                    <!-- 희망근무요일 -->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">근무요일</span>
                        </div>
                        <div class="incruite_box2">
                            <ul class="horizontal-list">
                                <li>
                                    <label><input type="checkbox" class="day" name="jobDays" value="MON" checked="checked" >월</label>
                                </li>
                                <li>
                                    <label><input type="checkbox" class="day"  name="jobDays" value="TUES" checked="checked" >화</label>
                                </li>
                                <li>
                                    <label><input type="checkbox" class="day"  name="jobDays" value="WED" checked="checked" >수</label>
                                </li>
                                <li>
                                    <label><input type="checkbox" class="day"  name="jobDays" value="THURS" checked="checked" >목</label>
                                </li>
                                <li>
                                    <label><input type="checkbox"  class="day" name="jobDays" value="FRI" checked="checked" >금</label>
                                </li>
                                <li>
                                    <label><input type="checkbox" class="day" name="jobDays" value="SAT" >토</label>
                                </li>
                                <li>
                                    <label><input type="checkbox" class="day" name="jobDays" value="SUN" >일</label>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <!--희망근무시간 -->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">근무시간</span>
                        </div>
                        <div class="incruite_box2">
                            <ul class="horizontal-list">
                                <li>
                                    <label><input type="radio"  name="jobTime" value="FULLTIME" checked>전일제 (10시 ~ 18시)</label>
                                </li>
                                <li>
                                    <label><input type="radio"  name="jobTime" value="PARTTIMEONE">시간제1 (13시 ~ 17시)</label>
                                </li>
                                <li>
                                    <label><input type="radio"  name="jobTime" value="PARTTIMETWO">시간제2 (13시 ~ 19시)</label>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <!--간단한 자기소개 -->
                    <li>
                        <div class="incruit_box1">
                            <span class="incruit_title">자기소개</span>
                        </div>
                        <div class="incruite_box2">
                            <input type="text" id="introduce" name="introduce" placeholder="간단한 자기소개" class="introduce" th:field="*{introduce}">
                        </div>

                    </li>
                    <br>


                    <button class="btn btn-primary solid blank mt-3" type="submit" onclick="beforeSubmit(); return false;">
                        수정하기
                    </button>
                </ul>
            </div>
        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    </form>
</main>

<!--각 페이지의 js가 작성될 위치지정-->
<th:block layout:fragment="script">
    <!--    <script th:src="@{plugins/ckeditor5/build/ckeditor.js}"></script>-->
    <!--    <script src="/js/rSlider.min.js"></script>-->

    <script  th:inline="javascript">

        //에러메시지 출력
        var errorMessage = [[${errorMessage}]];
        if(errorMessage != null) alert(errorMessage);

        var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");

        function beforeSubmit() {

            // 체크된 체크박스들의 값을 저장할 배열
            var checkedValues = [];

            // 체크된 체크박스들의 값을 배열에 추가
            $('input[type="checkbox"]:checked').each(function() {
                checkedValues.push($(this).val());
            });

            //서버에 전달할 데이터
            var paramData = {
                jobTitle : $("#jobTitle").val(),
                introduce : $('#introduce').val(),
                jobGender : $('input[name="jobGender"]:checked').val(),
                jobDays: checkedValues,
                jobAge : $('input[name="jobAge"]:checked').val(),
                career : $('input[name="career"]:checked').val(),
                jobTime : $('input[name="jobTime"]:checked').val(),
            }

             //JSON -> 문자열 변경(ajax는 전달하는 데이터를 문자열로 만들어야한다)
             var param = JSON.stringify(paramData);

            // AJAX 요청을 통해 서버로 선택된 값들을 전송
            $.ajax({
                url: '/jobPost/' +jobId, // 컨트롤러의 URL
                type: 'POST', // POST 요청
                contentType: 'application/json', // JSON 형태로 데이터 전송
                data: param, // 선택된 값들을 JSON 형태로 변환하여 전송
                beforeSend : function(xhr) {
					//데이터를 전송하기전에 헤더에 csrf 값을 설정
					xhr.setRequestHeader(header, token);
				},
                success: function(response) {
                    // 요청이 성공했을 때의 처리
                    location.href = "/jobpost/jobList";
                },
                error: function(xhr, status, error) {
                    // 요청이 실패했을 때의 처리
                    console.error('Error:', error);
                }
            });
        }

        function validateForm() {
        const title = document.getElementById('title'); // 제목 입력란

        // 제목 입력 확인
        if (!title.value.trim()) { // 입력란에 공백을 제외한 값이 없으면 true를 반환하고, 값이 있는 경우에는 false를 반환

            alert('제목을 입력해주세요.');
            return false;
        }

        return true; // 유효성 검사 통과
        }
    </script>
</th:block>
</html>