<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
    <!--헤더이 있는 토큰 값이 이거임 ! ! -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />

</head>

<main layout:fragment="content" class="main" style="text-align: -webkit-center;">

    <div class="sub_head">
        <span class="sub_head_title1">채용등록</span>
<!--        <span class="sub_head_title2">USE GUIDE</span>-->
    </div>
    <form role="form" th:object="${incruitPostFormDto}" name="incruitPostForm">
    <div class="box">
            <div class="incruit_box1">
                <span class="incruit_title" th:for="incruitTitle">제목</span>
            </div>
            <div class="incruite_box2">
                <input type="text" placeholder="제목을 입력해주세요" class="inputTitle"
                       th:field="*{incruitTitle}">
            </div>

        <div>
        <ul>
            <!--헬퍼 성별-->
            <li>
                <div class="incruit_box1">
                 <span class="incruit_title">성별</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <div>
                                <label><input type="radio" class="jobGender" name="jobGender" value="NONE" checked="checked">무관</label>
                            </div>
                        </li>
                        <li>
                            <div>
                                <label><input type="radio" class="jobGender" name="jobGender" value="FEMALE" >여성</label>
                            </div>
                        </li>
                        <li>
                            <div>
                                <label><input type="radio" class="jobGender" name="jobGender" value="MALE">남성</label>
                            </div>
                        </li>
                    </ul>
                </div>

            </li>
            <!--국적-->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">국적</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio" class="country" name="country" value="NOTHING">국적무관</label>
                        </li>
                        <li>
                            <label><input type="radio" class="country" name="country" value="KOREANS" checked="checked">한국인</label>
                        </li>
                        <li>
                            <label><input type="radio" class="country" name="country" value="KOREANCHINESE">조선족(교포)</label>
                        </li>
                        <li>
                            <label><input type="radio" class="country" name="country" value="FOREIGNERS">외국인</label>
                        </li>

                    </ul>
                </div>
            </li>
            <!--연령-->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">연령</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="ANYONE" checked="checked">연령무관</label>
                        </li>
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="TWENTIES" >20대</label>
                        </li>
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="THIRTIES">30대</label>
                        </li>
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="FORTIES">40대</label>
                        </li>
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="FIFTIES">50대</label>
                        </li>
                        <li>
                            <label><input type="radio" class="jobAge" name="jobAge" value="SIXTIES">60대</label>
                        </li>
                    </ul>
                </div>
            </li>

        </ul>

        <hr>

    <div class="incruit_box1">
        <div><span class="incruit_title2">돌봄이 필요한 아이의 <b>성별</b>과 <b>연령</b>을 선택해 주세요.</span></div>
        <br>
        <div>
            <!--아이의 성별-->
            <div class="ac mt40 clfix">
                <ul class="horizontal-list">
                    <li>
                        <div>
                            <label><input type="radio" class="incruitGender" name="incruitGender" value="FEMALE" checked="checked" >여아</label>
                        </div>
                    </li>
                    <li>
                        <div>
                            <label><input type="radio" class="incruitGender" name="incruitGender" value="MALE">남아</label>
                        </div>
                    </li>
                </ul>
            </div>
            <br>
            <!--아이의 나이-->
            <div class="ac modify_li3  clfix">
                <ul class="horizontal-list">
                    <li>
                        <label><input type="radio" class="incruitAge" name="incruitAge" value="BABY" checked="checked">신생아(0~6개월)</label>
                    </li>
                    <li>
                        <label><input type="radio" class="incruitAge" name="incruitAge" value="INFANT">영아(7~36개월)</label>
                    </li>
                    <li>
                        <label><input type="radio" class="incruitAge" name="incruitAge" value="CHILD">유아(4~7세)</label>
                    </li>
                    <li>
                        <label><input type="radio" class="incruitAge" name="incruitAge" value="STUDENT">초등학생(8세~13세)</label>
                    </li>
                </ul>
            </div>
        </div>
    </div>

        <hr>

        <ul>
            <!--반려동물-->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">반려동물</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio" class="pet" name="pet" value="DOG" checked="checked"> 강아지</label>
                        </li>
                        <li>
                            <label><input type="radio" class="pet" name="pet" value="CAT"> 고양이</label>
                        </li>
                        <li>
                            <label><input type="radio" class="pet" name="pet" value="NONE"> X </label>
                        </li>
                    </ul>
                </div>
            </li>
            <!-- cctv -->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">CCTV</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio" class="cctv" name="cctv" value="YES" checked="checked"> YES</label>
                        </li>
                        <li>
                            <label><input type="radio" class="cctv" name="cctv" value="NO"> NO </label>
                        </li>
                    </ul>
                </div>
            </li>
            <!--근무지역 -->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">근무지역</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio" class="location" name="location" value="YDP" checked="checked"> 영등포</label>
                        </li>
                        <li>
                            <label><input type="radio" class="location" name="location" value="GR"> 양천구 </label>
                        </li>
                        <li>
                            <label><input type="radio" class="location" name="location" value="YC"> 구로구 </label>
                        </li>
                    </ul>
                </div>
            </li>
            <!-- 근무요일 -->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">근무요일</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="checkbox" class="day" name="day" value="MON" checked="checked" >월</label>
                        </li>
                        <li>
                            <label><input type="checkbox" class="day"  name="day" value="TUES" checked="checked" >화</label>
                        </li>
                        <li>
                            <label><input type="checkbox" class="day"  name="day" value="WED" checked="checked" >수</label>
                        </li>
                        <li>
                            <label><input type="checkbox" class="day"  name="day" value="THURS" checked="checked" >목</label>
                        </li>
                        <li>
                            <label><input type="checkbox"  class="day" name="day" value="FRI" checked="checked" >금</label>
                        </li>
                        <li>
                            <label><input type="checkbox" class="day" name="day" value="SAT" >토</label>
                        </li>
                        <li>
                            <label><input type="checkbox" class="day" name="day" value="SUN" >일</label>
                        </li>

                    </ul>
                </div>
            </li>
            <!--근무시간 -->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title">근무시간</span>
                </div>
                <div class="incruite_box2">
                    <ul class="horizontal-list">
                        <li>
                            <label><input type="radio"  name="jobTime" value="FULLTIME" checked>전일제 (10시 ~ 18시)</label>
                        </li>
                        <li>
                            <label><input type="radio"  name="jobTime" value="PARTTIMEONE">시간제1 (13시 ~ 17시)</label>
                        </li>
                        <li>
                            <label><input type="radio"  name="jobTime" value="PARTTIMETWO">시간제2 (13시 ~ 19시)</label>
                        </li>
                    </ul>
                </div>
            </li>
            <!--시급-->
            <li>
                <div class="incruit_box1">
                    <span class="incruit_title"  th:for="incruitMoney">시급</span>
                </div>
                <div class="incruite_box2">
                    <input type="text" id="incruitMoney" name="incruitMoney" placeholder="시급을 입력해주세요" class="inputmoney"  th:field="*{incruitMoney}">
                </div>
            </li>

            <br>
            <li>
                <button class="btn btn-primary solid blank mt-3" type="button" onclick="beforeSubmit(); return false;">
                    게시물 등록하기
                </button>
            </li>
        </ul>
                </div>
            </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    </form>
</main>

<!--각 페이지의 js가 작성될 위치지정-->
<th:block layout:fragment="script">
    <!--    <script th:src="@{plugins/ckeditor5/build/ckeditor.js}"></script>-->
<!--    <script src="/js/rSlider.min.js"></script>-->
    <script  th:inline="javascript">

        //에러메시지 출력
       var errorMessage = [[${errorMessage}]];
       if(errorMessage != null) alert(errorMessage);

       var token = $("meta[name='_csrf']").attr("content");
       var header = $("meta[name='_csrf_header']").attr("content");


          function beforeSubmit() {
            // 체크된 체크박스들의 값을 저장할 배열
            var checkedValues = [];

            // 체크된 체크박스들의 값을 배열에 추가
            $('input[type="checkbox"]:checked').each(function() {
                checkedValues.push($(this).val());
            });



           //서버에 전달할 데이터
           var paramData = {
               incruitTitle : $('#incruitTitle').val(),
               jobGender : $('input[name="jobGender"]:checked').val(),
               country : $('input[name="country"]:checked').val(),
               cctv : $('input[name="cctv"]:checked').val(),
               jobAge : $('input[name="jobAge"]:checked').val(),
               incruitGender : $('input[name="incruitGender"]:checked').val(),
               incruitAge : $('input[name="incruitAge"]:checked').val(),
               pet : $('input[name="pet"]:checked').val(),
               location : $('input[name="location"]:checked').val(),
               incruitDays: checkedValues.map(function(value) {
                    return {day: value}
                }),
               location : $('input[name="location"]:checked').val(),
               jobTime : $('input[name="jobTime"]:checked').val(),
               incruitMoney : $('#incruitMoney').val(),

           }


             //JSON -> 문자열 변경(ajax는 전달하는 데이터를 문자열로 만들어야한다)
             var param = JSON.stringify(paramData);

           // AJAX 요청을 통해 서버로 선택된 값들을 전송
           $.ajax({
               url: '/incruitPost/new', // 컨트롤러의 URL
               type: 'POST', // POST 요청
               contentType: 'application/json', // JSON 형태로 데이터 전송
               data: param, // 선택된 값들을 JSON 형태로 변환하여 전송
               beforeSend : function(xhr) {
                   //데이터를 전송하기전에 헤더에 csrf 값을 설정
                   xhr.setRequestHeader(header, token);
               },
               success: function(response) {
                   // 요청이 성공했을 때의 처리
                   location.href = "/";
               },
               error: function(xhr, status, error) {
                   // 요청이 실패했을 때의 처리
                   console.error('Error:', error);
               }
           });
       }

       function validateForm() {
             const incruitTitle = document.getElementById('incruitTitle'); // incruitTitle 입력란

           // incruitTitle 입력 확인
           if (!incruitTitle.value.trim()) { // 입력란에 공백을 제외한 값이 없으면 true를 반환하고, 값이 있는 경우에는 false를 반환
               alert('제목을 입력해주세요.');
               return false;
           }

           return true; // 유효성 검사 통과
       }


    </script>
</th:block>
</html>